{"version":3,"sources":["webpack:///./src/component/Divide.jsx","webpack:///./src/component/Button.jsx","webpack:///./src/tools/imageCommon.js","webpack:///./src/tools/constant.js","webpack:///./src/tools/imageCreater.js","webpack:///./src/component/FramesModal.jsx","webpack:///./src/component/TransformSetting.jsx","webpack:///./src/component/Row.jsx","webpack:///./src/component/ImagePreviewUpload.jsx","webpack:///./src/tools/imageToText.js","webpack:///./src/tools/gifParser.js","webpack:///./src/tools/imageParser.js","webpack:///./src/tools/datauri.js","webpack:///./src/App.jsx","webpack:///./src/index.js"],"names":["Divide","react_default","a","createElement","className","Button","props","children","attrs","_objectWithoutProperties","classnames_default","_extends","type","IMAGE_TYPES_RE","PNG","JPG","GIF","getImageType","typeName","test","FONT_WIDTH","FONT_HEIGHT","DEFAULT_AVAILABLE_TEXTS","TEXT_FONT","COLOR","getFrameCanvas","div","frame","canvas","document","width","scrollWidth","height","scrollHeight","ctx","getContext","fillStyle","bgColor","fillRect","color","font","i","length","j","fillText","DEFAULT_GIF_PROPS","DEFAULT_NOGIF_PROPS","createImage","option","frames","file","imageCreater_objectWithoutProperties","link","filename","name","split","join","download","cb","Object","assign","gif","gif_default","quality","workers","workerScript","on","blob","text","addFrame","delay","render","imageCreater_gif","url","URL","createObjectURL","href","click","revokeObjectURL","toDataURL","noGif","FramesModal","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","getPrototypeOf","call","savePic","outputRef","current","state","setColor","ev","setState","target","value","setBgColor","close","preventDefault","stop","open","play","frameIndex","playTimer","createRef","PureComponent","_this2","nextFrame","setTimeout","nextIndex","clearTimeout","modalClasses","modal","onClick","htmlFor","id","onChange","style","backgroundColor","ref","map","line","index","key","nextProps","TransformSetting_TransformSetting","label","labelFor","defaultProps","Row","Row_objectWithoutProperties","Row_extends","ImagePreviewUpload","ImagePreviewUpload_classCallCheck","ImagePreviewUpload_possibleConstructorReturn","dragEnter","isDragging","dragOver","dragLeave","drop","dataTransfer","files","previewImage","openFileInput","fileUpload","setFile","currentImageRef","componentRef","Component","checkImageType","reader","FileReader","readAsDataURL","addEventListener","image","Image","scaleImageContainer","setImageAndFile","src","result","alert","container","parentElement","targetWidth","previewWidth","clientWidth","ratio","targetHeight","uploadBlockClasses","active","onDragEnter","onDragOver","onDragLeave","onDrop","display","accept","MAX_COLOR_PIXELS","createGrayToTextFunc","texts","arguments","undefined","grayGap","gray","textIndex","gifParser","buffer","arr","lastImageData","view","Uint8Array","offset","info","header","w","h","m","cr","s","pixel","bgIndex","radio","colorTable","comment","readByte","len","slice","decode","bytes","Error","appVersion","forEach","e","String","fromCharCode","extension","disp","t","tranIndex","push","console","log","img","x","y","r","encodeSize","encodeBuf","byte","match","getHeader","imageData","getImageData","lzw","data","putImageData","min","clearCode","eofCode","size","dict","pos","clear","readBit","code","out","last","concat","apply","scaleFrameData","frameData","nartualCanvas","nartualCtx","naturalWidth","naturalHeight","scaleCanvas","scaleCtx","scale","drawImage","imageParser_gif","_gifParser","uri","commaIndex","indexOf","meta","substring","byteString","atob","unescape","charCodeAt","rawWidth","rawHeight","framesData","ImageData","getImageDatas","imageParser_noGif","App","App_classCallCheck","App_possibleConstructorReturn","rawImage","setTransformType","transformType","setTransformPlaceholder","transformPlaceholder","setTransformWidth","nextNumber","parseInt","isNaN","transformWidth","toString","rescale","imagePreview","transform","isParsing","getCurrentImage","g","b","grayToText","dataArr","lines","transformImageToText","transformResult","framesModal","rel","position","top","right","border","alt","component_TransformSetting","component_ImagePreviewUpload","component_FramesModal","react_dom_default","src_App","getElementById"],"mappings":"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","file":"js/app.66d297dd8998f4bf37ab.js","sourcesContent":["import React from 'react'\r\n\r\n/**\r\n * 分割线组件\r\n *\r\n * @export\r\n * @returns\r\n */\r\nexport default function Divide() {\r\n  return <div className=\"divide\" />\r\n}\r\n","import React from 'react'\r\nimport classNames from 'classnames'\r\n\r\n/**\r\n * 按钮组件\r\n *\r\n * @export\r\n * @param {React.ButtonHTMLAttributes<HTMLButtonElement>} props\r\n * @returns\r\n */\r\nexport default function Button(props) {\r\n  let { children, className, ...attrs } = props\r\n  className = classNames(className, 'btn')\r\n  return (\r\n    <button {...attrs} type=\"button\" className={className}>\r\n      {children}\r\n    </button>\r\n  )\r\n}\r\n","const IMAGE_TYPES_RE = {\r\n  PNG: /image\\/png/,\r\n  JPG: /image\\/jpe?g/,\r\n  GIF: /image\\/gif/,\r\n}\r\n\r\n/**\r\n * 获取图片类型(png, jpg, gif)\r\n *\r\n * @export\r\n * @param {string} type\r\n * @returns\r\n */\r\nexport function getImageType(type) {\r\n  for (const typeName in IMAGE_TYPES_RE) {\r\n    const typeRe = IMAGE_TYPES_RE[typeName]\r\n    if (typeRe.test(type)) {\r\n      return typeName\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 检测图片类型是否可用\r\n *\r\n * @export\r\n * @param {any} type\r\n * @returns\r\n */\r\nexport function checkImageType(type) {\r\n  for (const typeName in IMAGE_TYPES_RE) {\r\n    const typeRe = IMAGE_TYPES_RE[typeName]\r\n    if (typeRe.test(type)) {\r\n      return true\r\n    }\r\n  }\r\n  return false\r\n}","// imageCreate.js, imageToText.js\r\nexport const FONT_WIDTH = 6\r\nexport const FONT_HEIGHT = 12\r\n\r\n// imageToText.js\r\nexport const DEFAULT_AVAILABLE_TEXTS = '@#&$%863!i1uazvno~;*^+-. '","import GIF from 'gif.js'\r\nimport { getImageType } from './imageCommon'\r\nimport { FONT_HEIGHT, FONT_WIDTH } from './constant'\r\n\r\n// pre标签下的字体\r\nconst TEXT_FONT = `normal normal 400 normal ${FONT_HEIGHT}px / ${FONT_HEIGHT}px monospace, monospace`\r\nconst COLOR = {\r\n  BLACK: 'rgba(0,0,0,1)',\r\n  WHITE: 'rgba(255,255,255,1)'\r\n}\r\n\r\n/**\r\n * @typedef Frame\r\n * @prop {ImageData} data\r\n * @prop {string[]} text\r\n * @prop {number} delay\r\n */\r\n\r\n/**\r\n * 获取渲染了单帧图片的 canvas 对象\r\n *\r\n * @param {HTMLDivElement} div\r\n * @param {Frame} frame\r\n * @param {object} props\r\n * @returns\r\n */\r\nfunction getFrameCanvas(div, frame, props) {\r\n  const canvas = document.createElement('canvas')\r\n  canvas.width = div.scrollWidth\r\n  canvas.height = div.scrollHeight\r\n  const ctx = canvas.getContext('2d')\r\n  ctx.fillStyle = props.bgColor\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height)\r\n  ctx.fillStyle = props.color\r\n  ctx.font = props.font\r\n  for (let i = 0; i < frame.length; i++) {\r\n    for (let j = 0; j < frame[i].length; j++) {\r\n      ctx.fillText(frame[i][j], j * FONT_WIDTH, i * FONT_HEIGHT)\r\n    }\r\n  }\r\n  return canvas\r\n}\r\n\r\nconst DEFAULT_GIF_PROPS = {\r\n  bgColor: COLOR.WHITE,\r\n  color: COLOR.BLACK,\r\n  font: TEXT_FONT\r\n}\r\n/**\r\n * 创建gif图片\r\n *\r\n * @param {HTMLDivElement} div\r\n * @param {Frame[]} frames\r\n * @param {object} props\r\n * @returns\r\n */\r\nfunction gif(div, frames, props, cb) {\r\n  props = Object.assign({}, DEFAULT_GIF_PROPS, props)\r\n  const width = div.scrollWidth\r\n  const height = div.scrollHeight\r\n  const gif = new GIF({\r\n    quality: 10,\r\n    workers: 2,\r\n    workerScript: './js/gif.worker.js',\r\n    width,\r\n    height\r\n  })\r\n  gif.on('finished', function(blob) {\r\n    cb(blob)\r\n  })\r\n  for (let i = 0; i < frames.length; i++) {\r\n    const canvas = getFrameCanvas(div, frames[i].text, props)\r\n    gif.addFrame(canvas, {\r\n      delay: frames[i].delay\r\n    })\r\n  }\r\n  gif.render()\r\n}\r\n\r\nconst DEFAULT_NOGIF_PROPS = {\r\n  bgColor: COLOR.WHITE,\r\n  color: COLOR.BLACK,\r\n  font: TEXT_FONT\r\n}\r\n/**\r\n * 创建非gif图片(jpg)\r\n *\r\n * @param {HTMLDivElement} div\r\n * @param {Frame} frame\r\n * @param {object} props\r\n * @returns\r\n */\r\nfunction noGif(div, frame, props) {\r\n  props = Object.assign({}, DEFAULT_NOGIF_PROPS, props)\r\n  const canvas = getFrameCanvas(div, frame.text, props)\r\n  return canvas.toDataURL('image/png')\r\n}\r\n\r\n/**\r\n * 创建并下载新的图片\r\n *\r\n * @export\r\n * @param {object} option\r\n * @param {HTMLDivElement} option.div\r\n * @param {Frame[]} option.frames\r\n * @param {File} option.file\r\n */\r\nexport function createImage(option) {\r\n  const { div, frames, file, ...props } = option\r\n  const type = getImageType(file.type)\r\n\r\n  const link = document.createElement('a')\r\n  let filename = file.name.split('.')\r\n  filename[filename.length - 2] = filename[filename.length - 2] + '-text'\r\n  filename = filename.join('.')\r\n  link.download = filename\r\n\r\n  if (type === 'GIF') {\r\n    gif(div, frames, props, function(blob) {\r\n      const url = URL.createObjectURL(blob)\r\n      link.href = url\r\n      link.click()\r\n      URL.revokeObjectURL(url)\r\n    })\r\n  } else {\r\n    link.href = noGif(div, frames[0], props)\r\n    link.click()\r\n  }\r\n}\r\n","import React from 'react'\r\nimport classNames from 'classnames'\r\nimport Button from './Button'\r\nimport Divide from './Divide'\r\nimport { createImage } from '../tools/imageCreater'\r\nimport '../style/modal.css'\r\n\r\n/**\r\n * 显示图片转字符结果的模态框\r\n *\r\n * @export\r\n * @class FramesModal\r\n * @extends {React.PureComponent}\r\n */\r\nexport default class FramesModal extends React.PureComponent {\r\n\r\n  /**\r\n   * @typedef Frame\r\n   * @prop {ImageData} data\r\n   * @prop {string[]} text\r\n   * @prop {number} delay\r\n   */\r\n\r\n  /**\r\n   * Creates an instance of FramesModal.\r\n   *\r\n   * @param {object} props\r\n   * @param {Frame[]} props.frames\r\n   * @param {File} props.file\r\n   *\r\n   * @memberof FramesModal\r\n   */\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      open: false,\r\n      color: '#000000',\r\n      bgColor: '#ffffff',\r\n      frameIndex: 0\r\n    }\r\n    this.playTimer = null\r\n    this.outputRef = React.createRef()\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    // 组件销毁时，取消定时器\r\n    this.stop()\r\n  }\r\n\r\n  static getDerivedStateFromProps(nextProps) {\r\n    if (nextProps.file) {\r\n      // 更换文件时，将播放帧序号重置回0\r\n      return {\r\n        frameIndex: 0\r\n      }\r\n    }\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * 保存图片为文件\r\n   *\r\n   * @memberof FramesModal\r\n   */\r\n  savePic = () => {\r\n    const createOption = {\r\n      div: this.outputRef.current,\r\n      frames: this.props.frames,\r\n      file: this.props.file,\r\n      color: this.state.color,\r\n      bgColor: this.state.bgColor\r\n    }\r\n    createImage(createOption)\r\n  }\r\n\r\n  setColor = (ev) => {\r\n    this.setState({\r\n      color: ev.target.value\r\n    })\r\n  }\r\n\r\n  setBgColor = (ev) => {\r\n    this.setState({\r\n      bgColor: ev.target.value\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 播放gif图像\r\n   *\r\n   * @memberof FramesModal\r\n   */\r\n  play() {\r\n    // 不播放只有一帧的图片（非gif）\r\n    if (this.props.frames.length <= 1) {\r\n      return\r\n    }\r\n    const nextFrame = () => {\r\n      const delay = this.props.frames[this.state.frameIndex].delay\r\n      this.playTimer = setTimeout(() => {\r\n        let nextIndex = this.state.frameIndex + 1\r\n        if (nextIndex === this.props.frames.length) {\r\n          nextIndex = 0\r\n        }\r\n        this.setState({\r\n          frameIndex: nextIndex\r\n        }, nextFrame)\r\n      }, delay)\r\n    }\r\n    nextFrame()\r\n  }\r\n\r\n  /**\r\n   * 停止播放gif图像\r\n   *\r\n   * @memberof FramesModal\r\n   */\r\n  stop() {\r\n    if (this.playTimer) {\r\n      clearTimeout(this.playTimer)\r\n    }\r\n  }\r\n\r\n  close = ev => {\r\n    ev.preventDefault()\r\n    this.stop()\r\n    this.setState({\r\n      open: false\r\n    })\r\n  }\r\n\r\n  open = () => {\r\n    this.play()\r\n    this.setState({\r\n      open: true\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const modalClasses = classNames({\r\n      modal: true,\r\n      open: this.state.open\r\n    })\r\n    return (\r\n      <div className={modalClasses}>\r\n        <div className=\"modal-overlay\" />\r\n        <div className=\"modal-box\">\r\n          <div className=\"modal-header\">\r\n            <a href=\"#\" className=\"modal-close\" onClick={this.close}>X</a>\r\n            <h3 className=\"modal-title\">Results:</h3>\r\n          </div>\r\n          <Divide />\r\n          <div className=\"output-options\">\r\n            <label htmlFor=\"color\">Text Color:</label>\r\n            <input type=\"color\" id=\"color\" name=\"color\" value={this.state.color} onChange={this.setColor} />\r\n            <label htmlFor=\"color\">Background Color:</label>\r\n            <input type=\"color\" id=\"bgColor\" name=\"bgColor\" value={this.state.bgColor} onChange={this.setBgColor} />\r\n            <Button className=\"save-btn\" onClick={this.savePic}>\r\n              Save\r\n            </Button>\r\n          </div>\r\n          <Divide />\r\n          <div className=\"output-text-wrapper\">\r\n            <div id=\"output-text-block\" className=\"output-text-block\" style={{color: this.state.color, backgroundColor: this.state.bgColor}} ref={this.outputRef}>\r\n              {this.props.frames.length\r\n                ? this.props.frames[this.state.frameIndex].text.map((line, index) => <pre key={index}>{line}</pre>)\r\n                : null}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import React from 'react'\r\nimport '../style/transformSetting.css'\r\n\r\nexport default class TransformSetting extends React.PureComponent {\r\n\r\n  static defaultProps = {\r\n    label: '',\r\n    labelFor: ''\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"transform-setting\">\r\n        {this.props.label ? <label htmlFor={this.props.labelFor}>{this.props.label}</label> : null}\r\n        {this.props.children}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import React from 'react'\r\nimport classNames from 'classnames'\r\n\r\n/**\r\n * 行组件\r\n *\r\n * @export\r\n * @param {React.HTMLAttributes<HTMLDivElement>} props\r\n * @returns\r\n */\r\nexport default function Row(props) {\r\n  let { children, className, ...attrs } = props\r\n  className = classNames(className, 'row')\r\n  return (\r\n    <div {...attrs} className={className}>\r\n      {children}\r\n    </div>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport classNames from 'classnames'\r\nimport { checkImageType } from '../tools/imageCommon'\r\nimport '../style/imagePreviewUpload.css'\r\n/**\r\n * 图片上传预览组件\r\n *\r\n * @export\r\n * @class ImagePreviewUpload\r\n * @extends {React.Component}\r\n */\r\nexport default class ImagePreviewUpload extends React.Component {\r\n\r\n  /**\r\n   * Creates an instance of ImagePreviewUpload.\r\n   *\r\n   * @param {object} props\r\n   * @param {HTMLImageElement} props.image\r\n   * @param {File} props.file\r\n   * @param {number} props.previewWidth\r\n   * @param {Function} props.setImageAndFile\r\n   *\r\n   * @memberof ImagePreviewUpload\r\n   */\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      isDragging: false,\r\n      width: 400,\r\n      height: 250\r\n    }\r\n\r\n    /**\r\n     * @type {React.RefObject<HTMLInputElement>}\r\n     */\r\n    this.fileUpload = React.createRef()\r\n    this.currentImageRef = React.createRef()\r\n    this.componentRef = React.createRef()\r\n  }\r\n\r\n  /**\r\n   * 返回当前显示图像的引用（有宽高变化）\r\n   *\r\n   * @returns\r\n   * @memberof ImagePreviewUpload\r\n   */\r\n  getCurrentImage() {\r\n    return this.currentImageRef.current\r\n  }\r\n\r\n  dragEnter = ev => {\r\n    ev.preventDefault()\r\n    this.setState({\r\n      isDragging: true\r\n    })\r\n  }\r\n\r\n  dragOver = ev => {\r\n    ev.preventDefault()\r\n  }\r\n\r\n  dragLeave = ev => {\r\n    ev.preventDefault()\r\n    this.setState({\r\n      isDragging: false\r\n    })\r\n  }\r\n\r\n  drop = ev => {\r\n    ev.preventDefault()\r\n    this.setState({\r\n      isDragging: false\r\n    })\r\n    const file = ev.dataTransfer.files[0]\r\n    this.previewImage(file)\r\n  }\r\n\r\n  openFileInput = () => {\r\n    this.fileUpload.current.click()\r\n  }\r\n\r\n  setFile = ev => {\r\n    const file = ev.target.files[0]\r\n    if (file) {\r\n      this.previewImage(file)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 预览图片文件\r\n   *\r\n   * @param {File} file\r\n   * @memberof ImagePreviewUpload\r\n   */\r\n  previewImage(file) {\r\n    if (!checkImageType(file.type)) {\r\n      alert('不支持该格式的文件')\r\n      return\r\n    }\r\n    const reader = new FileReader()\r\n    reader.readAsDataURL(file)\r\n    reader.addEventListener('load', () => {\r\n      const image = new Image()\r\n      image.addEventListener('load', () => {\r\n        this.scaleImageContainer(image)\r\n        this.props.setImageAndFile(image, file)\r\n      })\r\n      image.src = reader.result\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 等比例缩放图片尺寸\r\n   *\r\n   * @param {HTMLImageElement} image\r\n   */\r\n  scaleImageContainer(image) {\r\n    if (!image) {\r\n      // 不传递image时，使用当前的image（App组件传递）\r\n      image = this.props.image\r\n    }\r\n    const container = this.componentRef.current.parentElement\r\n    let targetWidth = this.props.previewWidth\r\n\r\n    // 缩放宽度检测\r\n    if (!targetWidth) {\r\n      // 没有指定宽度(或为0), 使用容器宽度\r\n      targetWidth = container.clientWidth\r\n      // 容器宽度比图片原宽度大，使用图片原宽度\r\n      if (image.width < targetWidth) {\r\n        targetWidth = image.width\r\n      }\r\n    } else if (targetWidth > container.clientWidth) {\r\n      alert('Exceeds container size! Please re-enter image width')\r\n      return\r\n    }\r\n\r\n    const ratio = image.width / targetWidth\r\n    const targetHeight = image.height / ratio\r\n    this.setState({\r\n      width: targetWidth,\r\n      height: targetHeight\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const uploadBlockClasses = classNames('upload-image-block', {active: this.state.isDragging}, this.props.className)\r\n    return (\r\n      <div\r\n        onDragEnter={this.dragEnter}\r\n        onDragOver={this.dragOver}\r\n        onDragLeave={this.dragLeave}\r\n        onDrop={this.drop}\r\n        onClick={this.openFileInput}\r\n        className={uploadBlockClasses}\r\n        style={{ width: this.state.width, height: this.state.height }}\r\n        ref={this.componentRef}\r\n      >\r\n        <input type=\"file\" style={{ display: 'none' }} accept=\"image/*\" ref={this.fileUpload} onChange={this.setFile} />\r\n        <span className=\"upload-label\">Upload</span>\r\n        {this.props.image ? <img ref={this.currentImageRef} src={this.props.image.src} className=\"preview-image\" /> : null}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import { FONT_HEIGHT, FONT_WIDTH, DEFAULT_AVAILABLE_TEXTS } from './constant'\r\n\r\n/**\r\n * 获取rgb颜色的灰度\r\n *\r\n * @param {number} r\r\n * @param {number} g\r\n * @param {number} b\r\n * @returns\r\n */\r\nfunction rgbToGray(r, g, b) {\r\n  return (299 * r + 587 * g + 114 * b + 500) / 1000\r\n}\r\n\r\nexport const MAX_COLOR_PIXELS = 255\r\n\r\n/**\r\n * 灰度转字符函数生成器\r\n *\r\n * @param {string | Array<string>} texts\r\n * @returns\r\n */\r\nexport function createGrayToTextFunc(texts = DEFAULT_AVAILABLE_TEXTS) {\r\n\r\n  const grayGap = MAX_COLOR_PIXELS / texts.length\r\n\r\n  /**\r\n   * 灰度转字符函数\r\n   *\r\n   * @param {number} gray\r\n   * @returns\r\n   */\r\n  function grayToText(gray) {\r\n    let textIndex = (gray / grayGap) >> 0\r\n    if (textIndex >= texts.length) {\r\n      textIndex = texts.length - 1\r\n    }\r\n    return texts[textIndex]\r\n  }\r\n\r\n  return grayToText\r\n}\r\n\r\n/**\r\n * 将图像的一帧转成字符数组\r\n *\r\n * @param {ImageData} imageData\r\n * @param {Function} [grayToText=defaultGrayToText]\r\n * @returns\r\n */\r\nexport function transformImageToText(imageData, grayToText = createGrayToTextFunc()) {\r\n  const dataArr = imageData.data\r\n  const width = imageData.width\r\n  const height = imageData.height\r\n  const lines = []\r\n  for (let h = 0; h < height; h += FONT_HEIGHT) {\r\n    let line = ''\r\n    for (let w = 0; w < width; w += FONT_WIDTH) {\r\n      const i = (w + width * h) * 4\r\n      const gray = rgbToGray(dataArr[i], dataArr[i + 1], dataArr[i + 2])\r\n      line += grayToText(gray)\r\n    }\r\n    lines.push(line)\r\n  }\r\n  return lines\r\n}\r\n","/**\r\n * Gif解析\r\n * https://github.com/intellilab/GIFParser\r\n *\r\n * @param {ArrayLike<number> | ArrayBufferLike} buffer\r\n * @returns\r\n */\r\nexport default function gifParser (buffer) {\r\n  const view = new Uint8Array(buffer)\r\n  let offset = 0\r\n  const info = {\r\n    /**\r\n     * 署名和版本号信息\r\n     */\r\n    header: '',\r\n    /**\r\n     * 图像宽度\r\n     */\r\n    w: 0,\r\n    /**\r\n     * 图像高度\r\n     */\r\n    h: 0,\r\n    /**\r\n     * m - 全局颜色列表标志\r\n     */\r\n    m: 0,\r\n    /**\r\n     * cr - 颜色深度(Color ResoluTion)\r\n     */\r\n    cr: 0,\r\n    /**\r\n     * s - 分类标志(Sort Flag)\r\n     */\r\n    s: 0,\r\n    /**\r\n     * pixel - 全局颜色列表大小\r\n     */\r\n    pixel: 0,\r\n    /**\r\n     * 背景颜色: 背景颜色在全局颜色列表中的索引\r\n     */\r\n    bgIndex: 0,\r\n    /**\r\n     * 像素宽高比\r\n     */\r\n    radio: 1,\r\n    /**\r\n     * 全局颜色列表信息\r\n     */\r\n    colorTable: [],\r\n    frames: [],\r\n    comment: ''\r\n  }\r\n  let frame\r\n\r\n  /**\r\n   * 读取指定长度字节\r\n   *\r\n   * @param {number} len\r\n   * @returns\r\n   */\r\n  function readByte(len) {\r\n    return view.slice(offset, (offset += len))\r\n  }\r\n\r\n  /**\r\n   * 读取gif头部信息 (起始 6 byte)\r\n   * 包括署名 (Signature) 和版本号 (Version)\r\n   */\r\n  function getHeader() {\r\n    const GIF_SIGNATURE_RE = /^GIF8[79]a$/\r\n    info.header = ''\r\n    readByte(6).forEach(byte => {\r\n      info.header += String.fromCharCode(byte)\r\n    })\r\n    if (!info.header.match(GIF_SIGNATURE_RE)) {\r\n      throw new Error('GIF署名错误')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 读取逻辑屏幕标识符 (Logical Screen Descriptor), 总共 7 byte\r\n   */\r\n  function getScreenDesc() {\r\n    const arr = readByte(7)\r\n\r\n    info.w = arr[0] + (arr[1] << 8)\r\n    info.h = arr[2] + (arr[3] << 8)\r\n    info.m = 1 & (arr[4] >> 7)\r\n    info.cr = 7 & (arr[4] >> 4)\r\n    info.s = 1 & (arr[4] >> 3)\r\n    info.pixel = 7 & arr[4]\r\n    info.bgIndex = arr[5]\r\n    info.radio = arr[6]\r\n\r\n    // 若全局颜色列表标志位置数了，则读取全局颜色列表\r\n    if (info.m) {\r\n      // 2 << pixel === 1 << (pixel + 1) === 2^(pixel+1)\r\n      info.colorTable = readByte((2 << info.pixel) * 3)\r\n    }\r\n  }\r\n\r\n  function decode() {\r\n    let bytes = readByte(1)\r\n\r\n    switch (bytes[0]) {\r\n      case 0x21: //扩展块, 33\r\n        extension()\r\n        break\r\n      case 0x2c: //图像标识符, 44\r\n        bytes = readByte(9)\r\n        frame.img = {\r\n          x: bytes[0] + (bytes[1] << 8),\r\n          y: bytes[2] + (bytes[3] << 8),\r\n          w: bytes[4] + (bytes[5] << 8),\r\n          h: bytes[6] + (bytes[7] << 8),\r\n          m: 1 & (bytes[8] >> 7),\r\n          /**\r\n           * i - 交织标志(Interlace Flag)\r\n           */\r\n          i: 1 & (bytes[8] >> 6),\r\n          s: 1 & (bytes[8] >> 5),\r\n          r: 3 & (bytes[8] >> 3),\r\n          pixel: 7 & bytes[8],\r\n          colorTable: []\r\n        }\r\n\r\n        // 读取局部颜色列表信息\r\n        if (frame.img.m) {\r\n          frame.img.colorTable = readByte((2 << frame.img.pixel) * 3)\r\n        }\r\n\r\n        // 读取LZW编码的长度\r\n        frame.img.encodeSize = readByte(1)[0]\r\n\r\n        const encodeBuf = []\r\n        while (1) {\r\n          bytes = readByte(1)\r\n          if (bytes[0]) {\r\n            // arr[0] 为当前块的大小（不包括自己这个字节）\r\n            // 读取这个数据块的所有数据，并保存为一个数组\r\n            readByte(bytes[0]).forEach(e => {\r\n              encodeBuf.push(e)\r\n            })\r\n          } else {\r\n            frame.img.encodeBuf = encodeBuf\r\n            decode()\r\n            break\r\n          }\r\n        }\r\n        break\r\n      case 0x3b: // 终结符，59\r\n        console.log('Parse Finish.')\r\n        break\r\n      default:\r\n        // 未知标识符，报错\r\n        throw new Error('Unknow Byte Flag:' + bytes[0])\r\n    }\r\n  }\r\n\r\n  function extension() {\r\n    let bytes = readByte(1)\r\n    switch (bytes[0]) {\r\n      case 0xff: // 应用程序扩展, 255\r\n        if (readByte(1)[0] == 11) {\r\n          info.appVersion = ''\r\n          readByte(11).forEach(function(e) {\r\n            info.appVersion += String.fromCharCode(e)\r\n          })\r\n          while(1) {\r\n            bytes = readByte(1)\r\n            if (bytes[0]) {\r\n              readByte(bytes[0])\r\n            } else {\r\n              decode()\r\n              break\r\n            }\r\n          }\r\n        } else {\r\n          throw new Error('解析出错')\r\n        }\r\n        break\r\n      case 0xf9: // 图形控制扩展, 249\r\n        // 块大小固定为 4\r\n        if (readByte(1)[0] === 4) {\r\n          bytes = readByte(4)\r\n          frame = {}\r\n          frame.extension = {\r\n            // 处置方法\r\n            disp: 7 & (bytes[0] >> 2),\r\n            // 用户输入标准\r\n            i: 1 & (bytes[0] >> 1),\r\n            // 透明色标志\r\n            t: 1 & bytes[0],\r\n            // 延迟时间\r\n            delay: (bytes[1] + (bytes[2] << 8)) * 10,\r\n            // 透明色索引\r\n            tranIndex: bytes[3]\r\n          }\r\n          info.frames.push(frame)\r\n          // 标识块终结符\r\n          if (readByte(1)[0] == 0) {\r\n            decode()\r\n          } else {\r\n            throw new Error('解析出错')\r\n          }\r\n        } else {\r\n          throw new Error('解析出错')\r\n        }\r\n        break\r\n      case 0xfe: // 注释块, 254\r\n        bytes = readByte(1)\r\n        if (bytes[0]) {\r\n          readByte(bytes[0]).forEach(function(e) {\r\n            info.comment += String.fromCharCode(e)\r\n          })\r\n          if (readByte(1)[0] == 0) {\r\n            decode()\r\n          }\r\n        }\r\n        break\r\n      default:\r\n        console.log(bytes)\r\n        break\r\n    }\r\n  }\r\n\r\n  function calcPixel() {\r\n    let lastImageData\r\n    info.frames.forEach(function(frame) {\r\n      const canvas = document.createElement('canvas')\r\n      const ctx = canvas.getContext('2d')\r\n      // 判断使用局部颜色列表还是全局颜色列表\r\n      const colorTable = frame.img.m ? frame.img.colorTable : info.colorTable\r\n\r\n      canvas.width = info.w\r\n      canvas.height = info.h\r\n      let imageData = ctx.getImageData(0, 0, info.w, info.h)\r\n\r\n      lzw(frame.img.encodeBuf, frame.img.encodeSize)\r\n        .decode()\r\n        .forEach(function(pixel, i) {\r\n          imageData.data[i * 4] = colorTable[pixel * 3]\r\n          imageData.data[i * 4 + 1] = colorTable[pixel * 3 + 1]\r\n          imageData.data[i * 4 + 2] = colorTable[pixel * 3 + 2]\r\n          imageData.data[i * 4 + 3] = 255\r\n          if (frame.extension.t && pixel == frame.extension.tranIndex) {\r\n            imageData.data[i * 4 + 3] = 0\r\n          }\r\n        })\r\n      ctx.putImageData(imageData, frame.img.x, frame.img.y, 0, 0, frame.img.w, frame.img.h)\r\n      imageData = ctx.getImageData(0, 0, info.w, info.h)\r\n\r\n      if (lastImageData) {\r\n        for (let i = 0; i < imageData.data.length; i += 4) {\r\n          // 某个像素不透明度为 0，用上一帧的相应位置的数据填补\r\n          if (imageData.data[i + 3] == 0) {\r\n            imageData.data[i] = lastImageData.data[i]\r\n            imageData.data[i + 1] = lastImageData.data[i + 1]\r\n            imageData.data[i + 2] = lastImageData.data[i + 2]\r\n            imageData.data[i + 3] = lastImageData.data[i + 3]\r\n          }\r\n        }\r\n      }\r\n      if (frame.extension.disp === 1 || frame.extension.disp === 0) {\r\n        lastImageData = imageData\r\n      }\r\n      frame.data = imageData.data\r\n    })\r\n  }\r\n\r\n  getHeader()\r\n  getScreenDesc()\r\n  decode()\r\n  calcPixel()\r\n\r\n  return {\r\n    width: info.w,\r\n    height: info.h,\r\n    frames: info.frames.map(frame => ({\r\n      /**\r\n       * @type {Uint8ClampedArray}\r\n       */\r\n      data: frame.data,\r\n      /**\r\n       * @type {number}\r\n       */\r\n      delay: frame.extension.delay\r\n    }))\r\n  }\r\n}\r\n\r\n/**\r\n * lzw压缩算法（解压缩）\r\n *\r\n * @param {Array} arr\r\n * @param {number} min\r\n * @returns\r\n */\r\nconst lzw = function(arr, min) {\r\n  const clearCode = 1 << min\r\n  const eofCode = clearCode + 1\r\n  let size = min + 1\r\n  let dict = []\r\n  let pos = 0\r\n\r\n  /**\r\n   * 清除已存储的压缩映射表数据\r\n   */\r\n  function clear() {\r\n    dict = []\r\n    size = min + 1\r\n    for (let i = 0; i < clearCode; i++) {\r\n      dict[i] = [i]\r\n    }\r\n    dict[clearCode] = []\r\n    dict[eofCode] = null\r\n  }\r\n\r\n  /**\r\n   * 读取指定位数 bit，并转成10进制数字\r\n   *\r\n   * @param {number} size\r\n   * @returns\r\n   */\r\n  function readBit(size) {\r\n    let code = 0\r\n    for (let i = 0; i < size; i++) {\r\n      // arr[pos / 8] & (1 << (pos % 8))\r\n      if (arr[pos >> 3] & (1 << (pos & 7))) {\r\n        code |= 1 << i\r\n      }\r\n      pos++\r\n    }\r\n    return code\r\n  }\r\n\r\n  function decode() {\r\n    const out = []\r\n    let last // 前缀\r\n    let code // 后缀\r\n    while (1) {\r\n      last = code\r\n      code = readBit(size)\r\n\r\n      if (code == clearCode) {\r\n        // 第一个读到的 code 必然是 clearCode，会初始化数据\r\n        clear()\r\n        continue\r\n      } else if (code == eofCode) {\r\n        break\r\n      } else if (code < dict.length) {\r\n        // code 映射已知\r\n        if (last !== clearCode) {\r\n          dict.push(dict[last].concat(dict[code][0]))\r\n        }\r\n      } else if (code === dict.length) {\r\n        // code 映射未知\r\n        dict.push(dict[last].concat(dict[last][0]))\r\n      } else {\r\n        throw new Error('LZW解析出错')\r\n      }\r\n      out.push.apply(out, dict[code])\r\n      if (dict.length === 1 << size && size < 12) {\r\n        // 取值位数+1\r\n        size++\r\n      }\r\n    }\r\n    return out\r\n  }\r\n\r\n  return {\r\n    decode: decode\r\n  }\r\n}\r\n","import gifParser from './gifParser'\r\nimport * as datauri from './datauri'\r\nimport { getImageType } from './imageCommon'\r\n\r\n/**\r\n * 通过缩放比例压缩帧\r\n *\r\n * @param {ImageData} frameData\r\n * @param {HTMLImageElement} image\r\n */\r\nfunction scaleFrameData(frameData, image) {\r\n  // 方法来源：\r\n  // https://stackoverflow.com/questions/3448347/how-to-scale-an-imagedata-in-html-canvas\r\n\r\n  // 存放一帧原图像到canvas中\r\n  const nartualCanvas = document.createElement('canvas')\r\n  const nartualCtx = nartualCanvas.getContext('2d')\r\n  nartualCanvas.width = image.naturalWidth\r\n  nartualCanvas.height = image.naturalHeight\r\n  nartualCtx.putImageData(frameData, 0, 0)\r\n\r\n  // 新建一个canvas，宽高设为目标宽高，并进行画布缩放\r\n  const scaleCanvas = document.createElement('canvas')\r\n  const scaleCtx = scaleCanvas.getContext('2d')\r\n  scaleCanvas.width = image.width\r\n  scaleCanvas.height = image.height\r\n  const ratio = image.width / image.naturalWidth\r\n  scaleCtx.scale(ratio, ratio)\r\n  // 将保存的原图像使用drawImage绘制到新画布上\r\n  scaleCtx.drawImage(nartualCanvas, 0, 0)\r\n\r\n  return scaleCtx.getImageData(0, 0, image.width, image.height)\r\n}\r\n\r\n/**\r\n * 获取gif图像信息\r\n *\r\n * @param {HTMLImageElement} image\r\n * @returns\r\n */\r\nfunction gif(image) {\r\n  const data = datauri.decode(image.src)\r\n  const { width: rawWidth, height: rawHeight, frames } = gifParser(data)\r\n  const framesData = []\r\n  for(let i = 0; i < frames.length; i++) {\r\n    const frameData = new ImageData(frames[i].data, rawWidth, rawHeight)\r\n    framesData.push({\r\n      data: scaleFrameData(frameData, image),\r\n      delay: frames[i].delay\r\n    })\r\n  }\r\n  return framesData\r\n}\r\n\r\n/**\r\n * 获取非gif图像信息\r\n *\r\n * @param {HTMLImageElement} image\r\n * @returns\r\n */\r\nfunction noGif(image) {\r\n  const canvas = document.createElement('canvas')\r\n  const ctx = canvas.getContext('2d')\r\n  const ratio = image.width / image.naturalWidth\r\n  // 将画布内容缩放到与当前图像一致\r\n  canvas.width = image.width\r\n  canvas.height = image.height\r\n  ctx.scale(ratio, ratio)\r\n  // 绘制当前图像到canvas上\r\n  ctx.drawImage(image, 0, 0)\r\n  const imageData = ctx.getImageData(0, 0, image.width, image.height)\r\n  return [{ data: imageData, delay: null }]\r\n}\r\n\r\n\r\n/**\r\n * 获取图像信息\r\n *\r\n * @export\r\n * @param {HTMLImageElement} image\r\n * @param {File} file\r\n * @returns\r\n */\r\nexport function getImageDatas(image, file) {\r\n  const type = getImageType(file.type)\r\n  if (type === 'GIF') {\r\n    return gif(image)\r\n  } else {\r\n    return noGif(image)\r\n  }\r\n}\r\n","/**\r\n * datauri 转 Uint8Array\r\n * https://stackoverflow.com/questions/4998908/convert-data-uri-to-file-then-append-to-formdata\r\n *\r\n * @export\r\n * @param {string} uri\r\n * @returns\r\n */\r\nexport function decode(uri) {\r\n  // 找到分割 metadata 和 data 的逗号位置\r\n  const commaIndex = uri.indexOf(',')\r\n\r\n  const meta = uri.substring(5, commaIndex).split(';')  // 头部信息 metadata\r\n  const type = meta[0] || 'text/plain'\r\n\r\n  const data = uri.substring(commaIndex + 1)  // 内容信息\r\n  let byteString\r\n  if (meta.indexOf('base64') >= 0) {\r\n    byteString = atob(data)\r\n  } else {\r\n    byteString = unescape(data)\r\n  }\r\n  const buffer = new Uint8Array(byteString.length)\r\n  for (let i = 0; i < byteString.length; i++) {\r\n    buffer[i] = byteString.charCodeAt(i)\r\n  }\r\n  buffer.type = type\r\n\r\n  return buffer\r\n}\r\n","import React from 'react'\r\nimport Divide from './component/Divide'\r\nimport Button from './component/Button'\r\nimport FramesModal from './component/FramesModal'\r\nimport TransformSetting from './component/TransformSetting'\r\nimport Row from './component/Row'\r\nimport ImagePreviewUpload from './component/ImagePreviewUpload'\r\nimport { transformImageToText, createGrayToTextFunc } from './tools/imageToText'\r\nimport { getImageDatas } from './tools/imageParser'\r\nimport { DEFAULT_AVAILABLE_TEXTS } from './tools/constant'\r\n\r\nexport default class App extends React.Component {\r\n  constructor() {\r\n    super()\r\n    this.state = {\r\n      transformWidth: '',\r\n      transformResult: [],\r\n      transformPlaceholder: DEFAULT_AVAILABLE_TEXTS,\r\n      rawImage: null,\r\n      file: null\r\n    }\r\n    this.imagePreview = React.createRef()\r\n    this.framesModal = React.createRef()\r\n  }\r\n\r\n  setImageAndFile = (rawImage, file) => {\r\n    this.setState({rawImage, file})\r\n  }\r\n\r\n  setTransformType = (ev) => {\r\n    this.setState({\r\n      transformType: ev.target.value\r\n    })\r\n  }\r\n\r\n  setTransformPlaceholder = (ev) => {\r\n    this.setState({\r\n      transformPlaceholder: ev.target.value\r\n    })\r\n  }\r\n\r\n  setTransformWidth = (ev) => {\r\n    const value = ev.target.value\r\n    // 退格到无数字时，设置为0\r\n    const nextNumber = value.length ? parseInt(value, 10) : 0\r\n    // 值为非数字时，直接返回\r\n    if (isNaN(nextNumber)) {\r\n      return\r\n    }\r\n    this.setState({\r\n      // 设置为字符串，防止出现0开头数字的不正确显示\r\n      transformWidth: nextNumber.toString()\r\n    })\r\n  }\r\n\r\n  rescale = () => {\r\n    if (!this.state.file) {\r\n      return\r\n    }\r\n    this.imagePreview.current.scaleImageContainer()\r\n  }\r\n\r\n  /**\r\n   * 图片转字符\r\n   *\r\n   * @memberof App\r\n   */\r\n  transform = () => {\r\n    const file = this.state.file\r\n    if (!file) {\r\n      return\r\n    }\r\n    this.setState({\r\n      isParsing: true\r\n    })\r\n    /**\r\n     * @type {HTMLImageElement}\r\n     */\r\n    const image = this.imagePreview.current.getCurrentImage()\r\n    const framesData = getImageDatas(image, file)\r\n    framesData.forEach(frameData => {\r\n      frameData.text = transformImageToText(frameData.data, createGrayToTextFunc(this.state.transformPlaceholder || DEFAULT_AVAILABLE_TEXTS))\r\n    })\r\n    this.setState({\r\n      transformResult: framesData\r\n    }, () => {\r\n      this.framesModal.current.open()\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <header className=\"clear\">\r\n          <h1 className=\"text-center\">Transform from image to text</h1>\r\n        </header>\r\n        {/* github fork me ribbons */}\r\n        <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/kainstar/image-to-text\">\r\n          <img style={{position: 'absolute', top: 0, right: 0, border: 0}} src=\"https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png\" alt=\"Fork me on GitHub\"/>\r\n        </a>\r\n        <Divide/>\r\n        <Row className=\"transform-settings-wrapper\">\r\n          <TransformSetting label=\"Width:\" labelFor=\"transform-size\">\r\n            <input type=\"number\" id=\"transform-size\" className=\"transform-size-input\" name=\"transform-size\" value={this.state.transformWidth} onChange={this.setTransformWidth} />\r\n          </TransformSetting>\r\n          <Button onClick={this.rescale}>Resize</Button>\r\n          <TransformSetting label=\"Converted Chars:\" labelFor=\"transform-placeholder\">\r\n            <input type=\"text\" id=\"transform-placeholder\" className=\"transform-placeholder-input\" name=\"transform-placeholder\" value={this.state.transformPlaceholder} onChange={this.setTransformPlaceholder} />\r\n          </TransformSetting>\r\n          <Button onClick={this.transform}>Convert</Button>\r\n        </Row>\r\n        <Divide/>\r\n        <Row>\r\n          <ImagePreviewUpload file={this.state.file} image={this.state.rawImage} setImageAndFile={this.setImageAndFile} previewWidth={parseInt(this.state.transformWidth)} ref={this.imagePreview}></ImagePreviewUpload>\r\n        </Row>\r\n        <FramesModal ref={this.framesModal} frames={this.state.transformResult} file={this.state.file} />\r\n        <p className=\"helps\">When converting GIF or larger images, there may be a certain degree of lag, which is normal, please be patient。</p>\r\n        <p className=\"copyright text-center\">\r\n          <a href=\"https://github.com/kainstar\">Author: kainstar</a>, <a href=\"https://github.com/kainstar/image-to-text\">Project Repository</a>\r\n        </p>\r\n      </div>\r\n    )\r\n  }\r\n}","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport App from './App'\r\nimport './style/normalize.css'\r\nimport './style/index.css'\r\n\r\nif (module.hot) {\r\n  module.hot.accept()\r\n}\r\n\r\nReactDOM.render(<App />, document.getElementById('app'))\r\n"],"sourceRoot":""}